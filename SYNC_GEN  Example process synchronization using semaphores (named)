#include <stdio.h>
#include <semaphore.h>
#include <fcntl.h>
#include <sys/stat.h>
#include <sys/wait.h>
#include <unistd.h>

int main(){
    sem_t *s = sem_open("/mysem123", O_CREAT|O_EXCL, 0600, 0);
    if(s==SEM_FAILED){ perror("sem_open"); return 1; }
    pid_t pid = fork();
    if(pid==0){
        printf("Child waiting...\n"); sem_wait(s);
        printf("Child proceeding after parent\n");
        sem_close(s); _exit(0);
    } else {
        printf("Parent doing work\n"); sleep(1);
        sem_post(s);
        wait(NULL);
        sem_close(s); sem_unlink("/mysem123");
    }
    return 0;
}
